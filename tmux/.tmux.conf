# Modern Terminal Support
set -g default-terminal "tmux-256color"
set -ga terminal-overrides ",*256col*:Tc"

# Essential Performance Settings
set -s escape-time 0              # Eliminate vim mode switching delay
set -g history-limit 50000        # Generous scrollback buffer
set -g display-time 4000          # Status messages display for 4 seconds
set -g status-interval 5          # Update status every 5 seconds
set -g focus-events on            # Enable focus events for vim
setw -g aggressive-resize on      # Resize windows based on smallest client

# Better Window/Pane Management
set -g base-index 1               # Start counting windows at 1
setw -g pane-base-index 1         # Start counting panes at 1
set -g renumber-windows on        # Renumber windows after closing
set -g allow-rename off           # Don't rename windows automatically

# Change Prefix to Ctrl-a (more accessible than Ctrl-b)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Intuitive Split Commands
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Vim-style Navigation Without Prefix Key (Alt+hjkl)
bind -n M-h select-pane -L
bind -n M-j select-pane -D
bind -n M-k select-pane -U
bind -n M-l select-pane -R

# Resize Panes with Prefix + Vim Keys
bind -r h resize-pane -L 5
bind -r j resize-pane -D 5
bind -r k resize-pane -U 5
bind -r l resize-pane -R 5

# Quick Config Reload
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Enable Mouse Support
set -g mouse on

# Better Scrolling
bind -n WheelUpPane if-shell -F -t = "#{mouse_any_flag}" "send-keys -M" "if -Ft= '#{pane_in_mode}' 'send-keys -M' 'select-pane -t=; copy-mode -e; send-keys -M'"
bind -n WheelDownPane select-pane -t= \; send-keys -M

# Copy Mode Settings
setw -g mode-keys vi          # Use vi keys in copy mode

# Platform-specific Clipboard Integration
# macOS
if-shell "uname | grep -q Darwin" \
  "bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'pbcopy'"

# Linux with X11
if-shell "command -v xclip" \
  "bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'xclip -selection clipboard'"

# WSL
if-shell "grep -qi microsoft /proc/version" \
  "bind -T copy-mode-vi y send-keys -X copy-pipe-and-cancel 'clip.exe'"

# Copy Mode Bindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle
bind -T copy-mode-vi Escape send-keys -X cancel

# Smart Pane Switching with Awareness of Vim Splits
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|l?n?vim?x?|fzf)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'

# Window Navigation
bind -n M-Left previous-window
bind -n M-Right next-window

# Session Navigation
bind -n M-Up switch-client -p
bind -n M-Down switch-client -n

# Status Bar Configuration
set -g status-position bottom
set -g status-justify left
set -g status-style 'bg=colour234 fg=colour255'
set -g status-left-length 50
set -g status-right-length 100

# Status Left
set -g status-left '#[fg=colour232,bg=colour154] #S #[fg=colour154,bg=colour238] #[fg=colour222,bg=colour238] #(whoami) #[fg=colour238,bg=colour234] '

# Status Right  
set -g status-right '#[fg=colour238,bg=colour234]#[fg=colour255,bg=colour238] %H:%M:%S #[fg=colour249]#[fg=colour255,bg=colour249] %d-%b-%y '

# Window Status
setw -g window-status-format '#[fg=colour244,bg=colour234] #I:#W '
setw -g window-status-current-format '#[fg=colour234,bg=colour31]#[fg=colour255,bg=colour31] #I:#W #[fg=colour31,bg=colour234]'

# Pane Borders
set -g pane-border-style 'fg=colour238'
set -g pane-active-border-style 'fg=colour154'

# Message Styling
set -g message-style 'fg=colour232 bg=colour154'

# Clock Mode
setw -g clock-mode-colour colour154

# Activity Monitoring
setw -g monitor-activity on
set -g visual-activity off

# Prevent Accidental Exit
bind-key x kill-pane # skip "kill-pane X? (y/n)" prompt
set -g detach-on-destroy off  # don't exit from tmux when closing a session

# Useful Key Bindings
bind-key : command-prompt
bind-key L clear-history
bind-key space next-layout
bind-key enter next-layout

# Pane Synchronization (useful for running same command in multiple panes)
bind-key y setw synchronize-panes

# Join/Send Panes
bind-key j command-prompt -p "join pane from:" "join-pane -s '%%'"
bind-key s command-prompt -p "send pane to:" "join-pane -t '%%'"

# Quick Window Switching
bind -n C-S-Left swap-window -t -1 \; previous-window
bind -n C-S-Right swap-window -t +1 \; next-window

# Plugins (using TPM - Tmux Plugin Manager)
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'      # Sensible defaults
set -g @plugin 'tmux-plugins/tmux-resurrect'     # Session persistence
set -g @plugin 'tmux-plugins/tmux-continuum'     # Automatic saving
set -g @plugin 'tmux-plugins/tmux-yank'          # Better clipboard integration
set -g @plugin 'tmux-plugins/tmux-prefix-highlight' # Highlight when prefix pressed
set -g @plugin 'christoomey/vim-tmux-navigator'  # Seamless navigation between tmux panes and vim splits

# Plugin Configurations
set -g @resurrect-capture-pane-contents 'on'     # Save pane contents
set -g @resurrect-strategy-nvim 'session'        # Restore neovim sessions
set -g @continuum-restore 'on'                   # Auto restore sessions
set -g @continuum-save-interval '15'             # Save every 15 minutes

# Prefix Highlight Configuration
set -g @prefix_highlight_show_copy_mode 'on'
set -g @prefix_highlight_show_sync_mode 'on'

# Initialize TMUX Plugin Manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'